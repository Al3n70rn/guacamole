#!/usr/bin/env bash

set -e

# Wrapper script for spark-submit that finds Guacamole JARs and a Spark properties file.
#
# Example:
#
#   $ scripts/guacamole somatic-joint normal.bam tumor.bam --reference hg19.fasta --out out.vcf
#
# Default Spark-properties file is at conf/spark-defaults.conf, and configures a 4gb, 1-worker, local Spark master. To
# specify other Spark properties, set the $GUAC_CONF_PATH environment variable.

scripts_dir="$(dirname "${BASH_SOURCE[0]}")"

source "$scripts_dir/.jars-rc"
find_jars

# Build a spark properties file and set the variable $conf_file to its path.
source "$scripts_dir/.spark-rc"

# Run Spark!
time "$SPARK_HOME"/bin/spark-submit --properties-file "$conf_file" --jars "$deps" "$main_jar" "$@"
